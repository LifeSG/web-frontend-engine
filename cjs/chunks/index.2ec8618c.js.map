{"version":3,"file":"index.2ec8618c.js","sources":["../../../src/components/fields/image-upload/image-manager/image-manager.ts"],"sourcesContent":["import { useContext, useEffect, useRef, useState } from \"react\";\nimport { AxiosApiClient, FileHelper, ImageHelper } from \"../../../../utils\";\nimport { usePrevious } from \"../../../../utils/hooks\";\nimport { ImageContext } from \"../image-context\";\nimport { EImageStatus, IImage, ISharedImageProps, TImageUploadOutputFileType, TUploadMethod } from \"../types\";\n\ninterface IProps extends Omit<ISharedImageProps, \"maxFiles\"> {\n\teditImage: boolean;\n\tonChange: (...event: any[]) => void;\n\tcompress: boolean;\n\tdimensions: { width: number; height: number };\n\toutputType: TImageUploadOutputFileType;\n\tupload?: {\n\t\tmethod: TUploadMethod;\n\t\turl: string;\n\t};\n\tvalue: any;\n}\n\n/**\n * manages selected images by listening to images from context provider\n * rename / compress / upload\n */\nexport const ImageManager = (props: IProps) => {\n\t// =============================================================================\n\t// CONST, STATE, REFS\n\t// =============================================================================\n\tconst { accepts, compress, dimensions, editImage, onChange, maxSizeInKb, outputType, upload, value } = props;\n\tconst { images, setImages, setErrorCount } = useContext(ImageContext);\n\tconst previousImages = usePrevious(images);\n\tconst [managerErrorCount, setManagerErrorCount] = useState(0);\n\tconst previousValue = usePrevious(value);\n\tconst sessionId = useRef<string>();\n\n\t// =============================================================================\n\t// EFFECTS\n\t// =============================================================================\n\t// generate pseudo-random session id\n\tuseEffect(() => {\n\t\tsessionId.current = Array(5)\n\t\t\t.fill(0)\n\t\t\t.map(() => Math.random().toString(36).slice(2))\n\t\t\t.join(\"\");\n\t}, []);\n\n\tuseEffect(() => {\n\t\timages.forEach((image, index) => {\n\t\t\tconst previousFile = previousImages?.[index];\n\t\t\tif (image.status !== previousFile?.status || image.dataURL !== previousFile.dataURL) {\n\t\t\t\tswitch (image.status) {\n\t\t\t\t\tcase EImageStatus.INJECTED:\n\t\t\t\t\t\tFileHelper.dataUrlToBlob(image.dataURL)\n\t\t\t\t\t\t\t.then((blob) => {\n\t\t\t\t\t\t\t\tsetImages((prev) => {\n\t\t\t\t\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t\t\t\t\t...image,\n\t\t\t\t\t\t\t\t\t\tfile: new File([blob], image.name),\n\t\t\t\t\t\t\t\t\t\tstatus: EImageStatus.NONE,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\treturn updatedImages;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t\t\tsetImages((prev) => prev.filter((prev, i) => i !== index));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EImageStatus.NONE:\n\t\t\t\t\t\tFileHelper.getMimeType(image.file).then((mimeType) => {\n\t\t\t\t\t\t\tif (mimeType && accepts.map(FileHelper.fileExtensionToMimeType).includes(mimeType)) {\n\t\t\t\t\t\t\t\tsetImages((prev) => {\n\t\t\t\t\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t\t\t\t\t...image,\n\t\t\t\t\t\t\t\t\t\tname: FileHelper.deduplicateFileName(\n\t\t\t\t\t\t\t\t\t\t\timages.map(({ name }) => name),\n\t\t\t\t\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t\t\t\t\timage.name\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\ttype: mimeType,\n\t\t\t\t\t\t\t\t\t\tstatus: image.addedFrom !== \"schema\" ? image.status : EImageStatus.UPLOADED,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\treturn updatedImages;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (image.addedFrom !== \"schema\") {\n\t\t\t\t\t\t\t\t\tcompress ? compressImage(index, image) : convertImage(index, image);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetImages((prev) => {\n\t\t\t\t\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t\t\t\t\t...image,\n\t\t\t\t\t\t\t\t\t\tstatus: EImageStatus.ERROR_FORMAT,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\treturn updatedImages;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EImageStatus.TO_RECOMPRESS:\n\t\t\t\t\t\trecompressImage(index, image);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EImageStatus.COMPRESSED:\n\t\t\t\t\tcase EImageStatus.CONVERTED:\n\t\t\t\t\tcase EImageStatus.RECOMPRESSED:\n\t\t\t\t\t\tif (!editImage) {\n\t\t\t\t\t\t\tsetImages((prev) => {\n\t\t\t\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t\t\t\t...updatedImages[index],\n\t\t\t\t\t\t\t\t\tstatus: EImageStatus.UPLOAD_READY,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn updatedImages;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EImageStatus.UPLOAD_READY:\n\t\t\t\t\t\tuploadImage(index, image);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [images.map(({ status }) => status).join(\",\"), images.map(({ dataURL }) => dataURL).join(\",\")]);\n\n\t// track / update errors and values\n\tuseEffect(() => {\n\t\tlet updatedManagerErrorCount = 0;\n\t\timages.forEach((image) => {\n\t\t\tif (\n\t\t\t\t(image.type && !accepts.map(FileHelper.fileExtensionToMimeType).includes(image.type)) ||\n\t\t\t\t[EImageStatus.ERROR_GENERIC, EImageStatus.ERROR_SIZE].includes(image.status)\n\t\t\t) {\n\t\t\t\tupdatedManagerErrorCount++;\n\t\t\t}\n\t\t});\n\t\tsetErrorCount((prev) => Math.max(0, prev + updatedManagerErrorCount - managerErrorCount));\n\t\tsetManagerErrorCount(updatedManagerErrorCount);\n\n\t\tonChange({\n\t\t\ttarget: {\n\t\t\t\tvalue: images\n\t\t\t\t\t.filter(({ status }) => status === EImageStatus.UPLOADED)\n\t\t\t\t\t.map(({ dataURL, drawingDataURL, name, uploadResponse }) => ({\n\t\t\t\t\t\tfileName: name,\n\t\t\t\t\t\tdataURL: drawingDataURL || dataURL,\n\t\t\t\t\t\tuploadResponse,\n\t\t\t\t\t})),\n\t\t\t},\n\t\t});\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [images.map((image) => image.status).join(\",\")]);\n\n\tuseEffect(() => {\n\t\tif (previousValue !== undefined && value === undefined && images.length) {\n\t\t\tsetImages([]);\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [previousValue === undefined, value === undefined, images.length]);\n\n\t// =============================================================================\n\t// HELPER FUNCTIONS\n\t// =============================================================================\n\tconst getScale = (origWidth: number, origHeight: number): number => {\n\t\tlet scale = dimensions.width / origWidth;\n\t\tif (origHeight * scale > dimensions.height) {\n\t\t\tscale = dimensions.height / origHeight;\n\t\t}\n\t\treturn scale;\n\t};\n\n\tconst convertImage = async (index: number, image: IImage) => {\n\t\ttry {\n\t\t\tconst dataURL = await ImageHelper.convertBlob(image.file, FileHelper.fileExtensionToMimeType(outputType));\n\t\t\tconst filesize = FileHelper.getFilesizeFromBase64(dataURL);\n\n\t\t\tif (maxSizeInKb && filesize > maxSizeInKb * 1024) {\n\t\t\t\tsetImages((prev) => {\n\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t...prev[index],\n\t\t\t\t\t\tstatus: EImageStatus.ERROR_SIZE,\n\t\t\t\t\t};\n\t\t\t\t\treturn updatedImages;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetImages((prev) => {\n\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t...prev[index],\n\t\t\t\t\t\tdataURL,\n\t\t\t\t\t\tstatus: EImageStatus.CONVERTED,\n\t\t\t\t\t};\n\t\t\t\t\treturn updatedImages;\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsetImages((prev) => {\n\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t...prev[index],\n\t\t\t\t\tstatus: EImageStatus.ERROR_GENERIC,\n\t\t\t\t};\n\t\t\t\treturn updatedImages;\n\t\t\t});\n\t\t}\n\t};\n\n\tconst compressImage = async (index: number, imageToCompress: IImage) => {\n\t\ttry {\n\t\t\tconst dataURL = await FileHelper.fileToDataUrl(imageToCompress.file);\n\t\t\tconst image = await ImageHelper.dataUrlToImage(dataURL);\n\t\t\tconst origDim = { w: image.naturalWidth, h: image.naturalHeight };\n\t\t\tconst scale = getScale(origDim.w, origDim.h);\n\t\t\tlet compressed = await ImageHelper.resampleImage(image, { scale });\n\t\t\tif (maxSizeInKb) {\n\t\t\t\tcompressed = (await ImageHelper.compressImage(compressed, {\n\t\t\t\t\tfileSize: maxSizeInKb,\n\t\t\t\t})) as File;\n\t\t\t}\n\n\t\t\tif (maxSizeInKb && compressed.size > maxSizeInKb * 1024) {\n\t\t\t\tsetImages((prev) => {\n\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t...prev[index],\n\t\t\t\t\t\tstatus: EImageStatus.ERROR_SIZE,\n\t\t\t\t\t};\n\t\t\t\t\treturn updatedImages;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst dataURL = await FileHelper.fileToDataUrl(compressed);\n\t\t\t\tsetImages((prev) => {\n\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t...prev[index],\n\t\t\t\t\t\tdataURL,\n\t\t\t\t\t\tstatus: EImageStatus.COMPRESSED,\n\t\t\t\t\t};\n\t\t\t\t\treturn updatedImages;\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsetImages((prev) => {\n\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t...prev[index],\n\t\t\t\t\tstatus: EImageStatus.ERROR_GENERIC,\n\t\t\t\t};\n\t\t\t\treturn updatedImages;\n\t\t\t});\n\t\t}\n\t};\n\n\tconst recompressImage = async (index: number, imageToCompress: IImage) => {\n\t\tif (imageToCompress.drawingDataURL) {\n\t\t\ttry {\n\t\t\t\tconst image = await ImageHelper.dataUrlToImage(imageToCompress.drawingDataURL);\n\t\t\t\tconst origDim = { w: image.naturalWidth, h: image.naturalHeight };\n\t\t\t\tconst scale = getScale(origDim.w, origDim.h);\n\t\t\t\tlet scaledFile = await ImageHelper.resampleImage(image, { scale });\n\t\t\t\tscaledFile = (await ImageHelper.compressImage(scaledFile, { fileSize: maxSizeInKb })) as File;\n\n\t\t\t\tif (scaledFile.size > maxSizeInKb * 1024) {\n\t\t\t\t\tconst updatedImages = [...images];\n\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t...images[index],\n\t\t\t\t\t\tstatus: EImageStatus.ERROR_SIZE,\n\t\t\t\t\t};\n\t\t\t\t\tsetImages(updatedImages);\n\t\t\t\t} else {\n\t\t\t\t\tconst dataURL = await FileHelper.fileToDataUrl(scaledFile);\n\t\t\t\t\tconst updatedImages = [...images];\n\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t...images[index],\n\t\t\t\t\t\tdrawingDataURL: dataURL,\n\t\t\t\t\t\tstatus: EImageStatus.RECOMPRESSED,\n\t\t\t\t\t};\n\t\t\t\t\tsetImages(updatedImages);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsetImages((prev) => {\n\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t...prev[index],\n\t\t\t\t\t\tstatus: EImageStatus.ERROR_GENERIC,\n\t\t\t\t\t};\n\t\t\t\t\treturn updatedImages;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tconst uploadImage = async (index: number, iFile: IImage) => {\n\t\ttry {\n\t\t\tsetImages((prev) => {\n\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t...prev[index],\n\t\t\t\t\tstatus: EImageStatus.UPLOADING,\n\t\t\t\t};\n\t\t\t\treturn updatedImages;\n\t\t\t});\n\n\t\t\tlet response: unknown;\n\t\t\tif (upload?.method && upload?.url) {\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.append(\"dataURL\", iFile.drawingDataURL || iFile.dataURL || \"\");\n\t\t\t\tformData.append(\"sessionId\", sessionId.current || \"\");\n\t\t\t\tformData.append(\"slot\", `${iFile.slot}`);\n\t\t\t\tresponse = await new AxiosApiClient(\"\", undefined, undefined, true)[upload.method](\n\t\t\t\t\tupload.url,\n\t\t\t\t\tformData,\n\t\t\t\t\t{\n\t\t\t\t\t\tonUploadProgress: (progressEvent) => {\n\t\t\t\t\t\t\tconst { loaded, total } = progressEvent;\n\t\t\t\t\t\t\tconst percent = Math.floor((loaded * 100) / total);\n\t\t\t\t\t\t\tsetImages((prev) => {\n\t\t\t\t\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\t\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t\t\t\t\t...prev[index],\n\t\t\t\t\t\t\t\t\tuploadProgress: percent,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn updatedImages;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tsetImages((prev) => {\n\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t...prev[index],\n\t\t\t\t\tuploadResponse: response,\n\t\t\t\t\tstatus: EImageStatus.UPLOADED,\n\t\t\t\t};\n\t\t\t\treturn updatedImages;\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tsetImages((prev) => {\n\t\t\t\tconst updatedImages = [...prev];\n\t\t\t\tupdatedImages[index] = {\n\t\t\t\t\t...prev[index],\n\t\t\t\t\tstatus: EImageStatus.ERROR_GENERIC,\n\t\t\t\t};\n\t\t\t\treturn updatedImages;\n\t\t\t});\n\t\t}\n\t};\n\n\treturn null;\n};\n"],"names":["props","accepts","compress","dimensions","editImage","onChange","maxSizeInKb","outputType","upload","value","images","setImages","setErrorCount","useContext","ImageContext","previousImages","usePrevious","managerErrorCount","setManagerErrorCount","useState","previousValue","sessionId","useRef","useEffect","current","Array","fill","map","Math","random","toString","slice","join","forEach","image","index","previousFile","status","dataURL","EImageStatus","INJECTED","FileHelper","dataUrlToBlob","then","blob","prev","updatedImages","file","File","name","NONE","catch","filter","i","getMimeType","mimeType","fileExtensionToMimeType","includes","deduplicateFileName","type","addedFrom","UPLOADED","compressImage","convertImage","ERROR_FORMAT","TO_RECOMPRESS","recompressImage","COMPRESSED","CONVERTED","RECOMPRESSED","UPLOAD_READY","uploadImage","updatedManagerErrorCount","ERROR_GENERIC","ERROR_SIZE","max","target","drawingDataURL","uploadResponse","fileName","undefined","length","getScale","origWidth","origHeight","scale","width","height","async","ImageHelper","convertBlob","filesize","getFilesizeFromBase64","e","imageToCompress","fileToDataUrl","dataUrlToImage","origDim","w","naturalWidth","h","naturalHeight","compressed","resampleImage","fileSize","size","scaledFile","iFile","response","UPLOADING","method","url","formData","FormData","append","slot","AxiosApiClient","onUploadProgress","progressEvent","loaded","total","percent","floor","uploadProgress","err"],"mappings":"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"}